<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Study Discussion Club</title>
<style>
body{margin:0;font-family:sans-serif;background:#fffde7;}
.container{display:flex;justify-content:center;align-items:center;min-height:100vh;}
.card{background:#fff;padding:20px;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,0.1);width:90%;max-width:420px;}
h1,h2{margin:10px 0;}
button{width:100%;padding:12px;border:none;border-radius:10px;background:#007aff;color:white;font-weight:bold;margin-top:10px;}
.box{background:#fff;border:1px solid #eee;border-radius:8px;padding:10px;margin-top:10px;}
.menu-item{background:#fff6cc;padding:12px;margin:8px 0;border-radius:10px;cursor:pointer;}
.image-frame{border-radius:10px;overflow:hidden;margin-top:10px;}
.image-frame img{width:100%;display:block;}
.small{font-size:13px;color:#666;}
</style>
</head>
<body>
<div class="container">
  <div class="card" id="main"></div>
</div>

<script>
const app = document.getElementById("main");
const exams = ["UPSC","NEET","JEE","NDA","JUDICIARY"];
const SHEETDB_URL = "https://sheetdb.io/api/v1/gt8vb3ysgkonl";
const UPI_ID = "demo@upi";
const PLAN_DAYS = 20;

// --- Simple SPA flow ---
let screen = "welcome";
let selectedExam = null;
let codeInput = "";
let subscription = null;

function show(html){ app.innerHTML = html; }

function render(){
  if(screen==="welcome"){
    show(\`
      <h1>Study Discussion Club</h1>
      <p class="small">Welcome to SDC learning app</p>
      <button onclick="screen='exam';render()">Get Started</button>
    \`);
  }
  else if(screen==="exam"){
    let list = exams.map(e=>\`<div class='menu-item' onclick='selectedExam="\${e}";render()'>\${e}</div>\`).join("");
    show(\`
      <h2>Select Exam</h2>
      \${list}
      <button onclick="if(selectedExam){screen='payment';render()}">Proceed to Payment</button>
    \`);
  }
  else if(screen==="payment"){
    show(\`
      <h2>Subscription</h2>
      <div class='box'><b>Exam:</b> \${selectedExam}</div>
      <div class='box'>
        <ul style='text-align:left;font-size:14px;'>
          <li>Daily Current Affairs</li>
          <li>Daily Practice Questions</li>
          <li>Mind Maps & UPSC Book Summary</li>
          <li>Discussion & Contest Entry</li>
        </ul>
      </div>
      <button onclick="payNow()">Pay Now (UPI)</button>
      <div class='box'>
        <input id='code' placeholder='Enter code (BIGHIT)' style='width:100%;padding:10px;border-radius:8px;border:1px solid #ccc;margin-top:8px;'>
        <button onclick='applyCode()'>Apply Code</button>
      </div>
    \`);
  }
  else if(screen==="home"){
    let expiryText = subscription ? new Date(subscription.expiry).toDateString() : "No active plan";
    let menu = ["Current Affairs","Practice Questions","Mind Maps","UPSC Books Summary","Interview Practice Questions"];
    show(\`
      <h2>Study Discussion Club</h2>
      <div class='box'><b>Exam:</b> \${selectedExam}<br><b>Expiry:</b> \${expiryText}</div>
      \${menu.map(m=>\`<div class='menu-item' onclick='openContent("\${m}")'>\${m}</div>\`).join("")}
      <button onclick='screen="welcome";render()'>Logout</button>
    \`);
  }
  else if(screen.startsWith("content:")){
    let name = screen.split(":")[1];
    show(\`
      <h2>\${name}</h2>
      <div class='image-frame'><img src='https://i.imgur.com/UhPzHM1.jpeg'></div>
      <button onclick='screen="home";render()'>Back</button>
    \`);
  }
}

function payNow(){
  const upiUrl = \`upi://pay?pa=\${UPI_ID}&pn=StudyDiscussionClub&am=49&cu=INR&tn=Subscription\`;
  alert("Demo payment opening... Replace demo@upi with your real UPI ID");
  window.location.href = upiUrl;
  setTimeout(()=>{
    let start = new Date();
    let expiry = new Date(start.getTime() + PLAN_DAYS*24*60*60*1000);
    subscription = {start:start.toISOString(), expiry:expiry.toISOString()};
    fetch(SHEETDB_URL,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({data:[{exam:selectedExam,payment_status:"success",expiry:expiry.toISOString()}]})
    }).catch(()=>{});
    alert("Payment successful! Plan active till "+expiry.toDateString());
    screen="home"; render();
  },3000);
}

function applyCode(){
  let c = document.getElementById("code").value.trim().toUpperCase();
  if(c==="BIGHIT"){
    let start = new Date();
    let expiry = new Date(start.getTime() + PLAN_DAYS*24*60*60*1000);
    subscription = {start:start.toISOString(), expiry:expiry.toISOString()};
    alert("Code applied! Plan active till "+expiry.toDateString());
    screen="home"; render();
  } else {
    alert("Invalid code");
  }
}

function openContent(name){ screen="content:"+name; render(); }

render();
</script>
</body>
</html>
